# 后端架构设计文档

## 1. 整体架构概览
后端采用了经典的多层架构，主要包括以下几个层次：
- API层（控制器层）
- 中间件层
- 服务层（业务逻辑层）
- 数据访问层(DAL)
- 工具层

这种分层设计实现了关注点分离，各层有明确的职责边界，便于开发、测试和维护。

## 2. 各层详细说明

### 2.1 主应用（CrowApplication）
CrowApplication 是系统的入口点，负责初始化和启动整个后端应用：
- `main()`: 应用程序入口点
- `setupRoutes()`: 设置所有API路由
- `configureMiddleware()`: 配置中间件（认证、日志等）
- `run()`: 启动Crow服务器

### 2.2 API层（控制器层）
这一层负责处理HTTP请求，解析请求参数，调用相应的服务层组件，并构造HTTP响应：
- `ApiRouter`: 集中管理所有路由配置，将请求映射到对应的控制器方法
- `AuthController`: 处理用户认证相关请求（登录、注册、找回密码等）
- `UserController`: 处理个人用户信息管理
- `ResumeController`: 处理简历的CRUD操作
- `JobController`: 处理职位查询和申请
- `EnterpriseController`: 处理企业用户信息和职位管理
- `AdminController`: 处理管理员的各种管理功能
- `FeedbackController`: 处理用户反馈和留言

### 2.3 中间件层
中间件在请求处理流程中提供横切关注点的功能：
- `AuthMiddleware`: 验证请求中的JWT令牌，确保用户已认证且有权限访问资源
- `ErrorHandlingMiddleware`: 统一异常处理，将异常转换为适当的HTTP错误响应
- `LoggingMiddleware`: 记录请求和响应日志
- `ValidationMiddleware`: 请求数据验证，确保数据符合预期格式

### 2.4 服务层（业务逻辑层）
这一层实现核心业务逻辑，是系统的"大脑"：
- `AuthService`: 处理认证和授权逻辑
- `IndividualUserService`: 个人用户管理逻辑
- `ResumeService`: 简历管理业务逻辑
- `JobSearchService`: 职位搜索和查询逻辑
- `ApplicationService`: 职位申请处理逻辑
- `EnterpriseUserService`: 企业用户管理逻辑
- `JobPostingService`: 职位发布和管理逻辑
- `TalentSearchService`: 人才搜索和筛选逻辑
- `AdminService`: 系统管理功能逻辑
- `FeedbackService`: 用户反馈处理逻辑
- `AnnouncementService`: 系统公告管理逻辑

### 2.5 数据访问层（DAL）
负责与SQLite数据库交互，使用SQLiteCpp，封装SQL操作：
- `DatabaseManager`: 中央数据库连接管理器，提供连接池和事务支持
- 各种DAO（数据访问对象）: 如`IndividualUserDAO`、`ResumeDAO`等，每个DAO负责特定实体的CRUD操作

### 2.6 工具层
提供各种通用功能：
- `SecurityUtils`: 安全相关工具（密码哈希、JWT生成验证等）
- `ValidationUtils`: 数据验证工具
- `Logger`: 日志记录工具，使用crow自带的logging
- `ConfigManager`: 配置管理工具

## 3.后端组件函数说明

## 1. 主应用 (CrowApplication)

主应用是系统的入口点，负责初始化和启动整个后端应用。

### 1.1 CrowApplication
| 函数名               | 描述                                                                 |
| -------------------- | -------------------------------------------------------------------- |
| `main()`             | 应用程序的入口函数，是程序开始执行的地方。                                 |
| `setupRoutes()`      | 设置所有API路由，将HTTP请求路径映射到相应的处理逻辑。                         |
| `configureMiddleware()` | 配置应用所需的中间件，如认证、日志、错误处理等。                               |
| `run()`              | 启动Crow服务器，开始监听和处理HTTP请求。                                   |

## 2. API层 (控制器层)

API层负责处理客户端（前端）发送过来的HTTP请求，解析请求参数，调用相应的服务层组件来处理业务逻辑，并最终构造HTTP响应返回给客户端。

### 2.1 ApiRouter
| 函数名                  | 描述                                                               |
| ----------------------- | ------------------------------------------------------------------ |
| `setupRoutes(Crow::App)` | 集中管理所有API的路由配置，将不同的URL请求路径分发到对应的控制器处理函数。 |

### 2.2 AuthController (认证控制器)
处理用户认证相关的请求，包括登录、注册、密码管理等。

| 函数名                        | 描述                                                               |
| ----------------------------- | ------------------------------------------------------------------ |
| `registerIndividual(req, res)` | 处理个人用户的注册请求。                                                 |
| `loginIndividual(req, res)`    | 处理个人用户的登录请求。                                                 |
| `registerEnterprise(req, res)` | 处理企业用户的注册请求。                                                 |
| `loginEnterprise(req, res)`    | 处理企业用户的登录请求。                                                 |
| `loginAdmin(req, res)`         | 处理管理员用户的登录请求。                                               |
| `logout(req, res)`             | 处理用户退出登录的请求。                                                 |
| `forgotPassword(req, res)`     | 处理用户忘记密码，请求重置密码的流程。                                       |
| `resetPassword(req, res)`      | 处理用户通过验证后，设置新密码的请求。                                       |

### 2.3 UserController (个人用户控制器)
处理个人用户相关的操作，如信息管理、简历和申请查看。

| 函数名                          | 描述                                                               |
| ------------------------------- | ------------------------------------------------------------------ |
| `getCurrentUserInfo(req, res)`  | 获取当前登录个人用户的信息。                                               |
| `updateUserInfo(req, res)`      | 更新当前登录个人用户的信息。                                               |
| `changePassword(req, res)`      | 允许当前登录个人用户修改自己的密码。                                         |
| `getResumes(req, res)`          | 获取当前登录个人用户的所有简历列表。                                         |
| `getApplications(req, res)`     | 获取当前登录个人用户的职位申请记录。                                         |

### 2.4 ResumeController (简历控制器)
处理个人用户简历的创建、读取、更新和删除 (CRUD) 操作。

| 函数名                    | 描述                                             |
| ------------------------- | ------------------------------------------------ |
| `createResume(req, res)`  | 为当前登录个人用户创建一份新简历。                         |
| `getResume(req, res)`     | 获取指定ID的简历详情。                                 |
| `updateResume(req, res)`  | 更新指定ID的简历信息。                                 |
| `deleteResume(req, res)`  | 删除指定ID的简历。                                 |

### 2.5 JobController (职位控制器 - 针对个人用户)
处理个人用户视角下的职位查询和申请操作。

| 函数名                    | 描述                                             |
| ------------------------- | ------------------------------------------------ |
| `getJobs(req, res)`       | 查询职位列表，支持分页和筛选参数。                           |
| `getJobDetails(req, res)` | 获取指定ID的职位详细信息。                               |
| `applyForJob(req, res)`   | 个人用户申请指定ID的职位。                               |

### 2.6 EnterpriseController (企业控制器)
处理企业用户相关的操作，包括企业信息管理、职位发布与管理、查看申请者等。

| 函数名                               | 描述                                                               |
| ------------------------------------ | ------------------------------------------------------------------ |
| `getEnterpriseInfo(req, res)`        | 获取当前登录企业用户的信息。                                               |
| `updateEnterpriseInfo(req, res)`     | 更新当前登录企业用户的信息。                                               |
| `getPostedJobs(req, res)`            | 获取当前登录企业用户发布的职位列表。                                         |
| `postNewJob(req, res)`               | 当前登录企业用户发布新的招聘职位。                                         |
| `updateJob(req, res)`                | 更新指定ID的职位信息（由企业用户操作）。                                     |
| `deleteJob(req, res)`                | 删除指定ID的职位（由企业用户操作）。                                     |
| `getApplicants(req, res)`            | 获取指定职位的申请者列表。                                               |
| `updateApplicationStatus(req, res)` | 企业用户更新某个职位申请的状态（如：邀请面试、不合适）。                             |

### 2.7 AdminController (管理员控制器)
处理管理员相关的操作，如用户管理、企业审核、职位管理、反馈处理和公告管理。

| 函数名                            | 描述                                                               |
| --------------------------------- | ------------------------------------------------------------------ |
| `getUsers(req, res)`              | 管理员获取个人用户列表。                                                 |
| `updateUserStatus(req, res)`      | 管理员更新个人用户的账户状态（如禁用、启用）。                                   |
| `getEnterprises(req, res)`        | 管理员获取企业用户列表，可包含待审核的企业。                                     |
| `approveEnterprise(req, res)`     | 管理员批准企业用户的注册申请。                                             |
| `rejectEnterprise(req, res)`      | 管理员拒绝企业用户的注册申请。                                             |
| `getJobs(req, res)`               | 管理员获取系统内所有职位列表（用于管理或审核）。                                 |
| `updateJobStatus(req, res)`       | 管理员更新某个职位的状态（如审核通过、下架）。                                   |
| `getFeedbacks(req, res)`          | 管理员获取用户反馈列表。                                                 |
| `processFeedback(req, res)`       | 管理员处理（如回复）用户反馈。                                             |
| `getAnnouncements(req, res)`      | 管理员获取系统公告列表。                                                 |
| `createAnnouncement(req, res)`    | 管理员创建新的系统公告。                                                 |
| `updateAnnouncement(req, res)`    | 管理员更新已发布的系统公告。                                               |
| `deleteAnnouncement(req, res)`    | 管理员删除系统公告。                                                   |

### 2.8 FeedbackController (反馈控制器)
处理用户提交反馈以及可能的反馈查看。

| 函数名                       | 描述                                                                       |
| ---------------------------- | -------------------------------------------------------------------------- |
| `submitFeedback(req, res)`   | 用户（个人或企业）提交反馈或留言。                                                   |
| `getFeedbacks(req, res)`     | （可能指用户查看自己提交的反馈，或管理员调用，具体权限依据AuthMiddleware）获取反馈列表。 |

## 3. 中间件层 (Middleware)
中间件在请求处理流程中提供横切关注点的功能，如认证、日志、错误处理等。

### 3.1 AuthMiddleware (认证中间件)
负责验证请求中的用户身份和权限。

| 函数名                             | 描述                                                                     |
| ---------------------------------- | ------------------------------------------------------------------------ |
| `verifyToken(request, response, next)` | 验证请求中携带的JWT令牌，确认用户是否已认证。若验证失败，则中断请求；成功则传递给下一个处理程序。 |
| `checkRole(roles[])`               | 检查已认证用户的角色是否满足访问特定资源所需的角色权限。                                 |

### 3.2 ErrorHandlingMiddleware (错误处理中间件)
统一处理在请求处理过程中发生的异常，并将其转换为标准化的HTTP错误响应。

| 函数名                                     | 描述                                                                   |
| ------------------------------------------ | ---------------------------------------------------------------------- |
| `handleErrors(exception, request, response)` | 捕获未处理的异常，记录错误信息，并向客户端返回合适的错误信息和状态码。                         |

### 3.3 LoggingMiddleware (日志中间件)
记录传入请求和传出响应的相关信息，用于调试、监控和审计。

| 函数名                               | 描述                                                                     |
| ------------------------------------ | ------------------------------------------------------------------------ |
| `logRequest(request, response, next)` | 记录请求的详细信息（如方法、路径、头信息、参数）和响应信息（如状态码）。                         |

### 3.4 ValidationMiddleware (验证中间件)
根据预定义的规则或模式验证请求数据的有效性。

| 函数名                   | 描述                                                         |
| ------------------------ | ------------------------------------------------------------ |
| `validateRequest(schema)` | 验证请求体或查询参数是否符合预设的结构和数据类型。                               |

## 4. 服务层 (业务逻辑层)
服务层封装了系统的核心业务逻辑，处理具体的功能实现，不直接与HTTP请求或数据库打交道，而是通过控制器调用和数据访问层交互。

### 4.1 AuthService (认证服务)
处理所有与用户认证和授权相关的业务逻辑。

| 函数名                         | 描述                                                                     |
| ------------------------------ | ------------------------------------------------------------------------ |
| `registerIndividual(userData)` | 执行个人用户注册的业务逻辑，包括数据校验、密码加密、保存用户信息。                               |
| `loginIndividual(username, password)` | 执行个人用户登录的业务逻辑，包括验证用户凭据、生成认证令牌。                                 |
| `registerEnterprise(enterpriseData)` | 执行企业用户注册的业务逻辑，包括数据校验、保存企业信息（可能置为待审核状态）。                         |
| `loginEnterprise(username, password)` | 执行企业用户登录的业务逻辑，包括验证用户凭据、生成认证令牌。                                 |
| `loginAdmin(username, password)` | 执行管理员登录的业务逻辑。                                                       |
| `generateToken(userId, role)`  | 为指定用户ID和角色生成JWT（JSON Web Token）或其他类型的认证令牌。                           |
| `verifyToken(token)`           | 验证传入的认证令牌的有效性。                                                         |
| `requestPasswordReset(email)`  | 处理忘记密码请求，如生成密码重置令牌并发送邮件/短信。                                       |
| `resetPassword(token, newPassword)` | 根据有效的重置令牌和新密码来重置用户密码。                                             |

### 4.2 IndividualUserService (个人用户服务)
处理个人用户的账户管理相关的业务逻辑。

| 函数名                                         | 描述                                                       |
| ---------------------------------------------- | ---------------------------------------------------------- |
| `getUserById(userId)`                          | 根据用户ID获取个人用户的详细信息。                                     |
| `updateUserInfo(userId, userData)`             | 更新指定个人用户ID的用户信息。                                       |
| `changePassword(userId, oldPassword, newPassword)` | 为指定个人用户ID修改密码，需验证旧密码。                                 |

### 4.3 ResumeService (简历服务)
处理与个人用户简历相关的业务逻辑。

| 函数名                           | 描述                                         |
| -------------------------------- | -------------------------------------------- |
| `createResume(userId, resumeData)` | 为指定用户ID创建新的简历。                               |
| `getResumeById(resumeId)`        | 根据简历ID获取简历的详细信息。                             |
| `getResumesByUserId(userId)`     | 获取指定用户ID的所有简历。                                 |
| `updateResume(resumeId, resumeData)` | 更新指定简历ID的简历信息。                               |
| `deleteResume(resumeId)`         | 删除指定简历ID的简历。                                 |

### 4.4 JobSearchService (职位搜索服务)
处理个人用户搜索和查看职位的业务逻辑。

| 函数名                 | 描述                                                               |
| ---------------------- | ------------------------------------------------------------------ |
| `searchJobs(criteria)` | 根据指定的搜索条件（如关键词、行业、地点等）查询职位列表。                               |
| `getJobById(jobId)`    | 根据职位ID获取职位的详细信息。                                           |
| `getRelatedJobs(jobId)`| (可选) 获取与指定职位ID相关的其他职位推荐。                                    |

### 4.5 ApplicationService (职位申请服务)
处理个人用户申请职位以及管理申请记录的业务逻辑。

| 函数名                                      | 描述                                                                       |
| ------------------------------------------- | -------------------------------------------------------------------------- |
| `applyForJob(userId, resumeId, jobId)`      | 用户使用其指定简历申请某个职位。                                                       |
| `getUserApplications(userId)`               | 获取指定用户的所有职位申请记录。                                                       |
| `getApplicationById(applicationId)`         | 根据申请ID获取申请的详细信息。                                                       |
| `updateApplicationStatus(applicationId, status)` | 更新职位申请的状态（此函数可能由企业用户或管理员通过相应服务调用，也可能在此服务内被调用）。 |

### 4.6 EnterpriseUserService (企业用户服务)
处理企业用户的账户管理相关的业务逻辑。

| 函数名                                            | 描述                                                         |
| ------------------------------------------------- | ------------------------------------------------------------ |
| `getEnterpriseById(enterpriseId)`                 | 根据企业ID获取企业用户的详细信息。                                       |
| `updateEnterpriseInfo(enterpriseId, enterpriseData)` | 更新指定企业ID的企业信息。                                         |
| `changePassword(enterpriseId, oldPassword, newPassword)` | 为指定企业ID修改密码，需验证旧密码。                                   |

### 4.7 JobPostingService (职位发布服务)
处理企业用户发布和管理招聘职位的业务逻辑。

| 函数名                                 | 描述                                                         |
| -------------------------------------- | ------------------------------------------------------------ |
| `createJob(enterpriseId, jobData)`     | 指定企业ID发布新的招聘职位。                                         |
| `getJobById(jobId)`                    | 根据职位ID获取职位信息（可能用于企业编辑或查看）。                               |
| `getJobsByEnterpriseId(enterpriseId)`  | 获取指定企业ID发布的所有职位。                                       |
| `updateJob(jobId, jobData)`            | 更新指定职位ID的职位信息。                                         |
| `deleteJob(jobId)`                     | 删除指定职位ID的职位。                                         |
| `toggleJobStatus(jobId, status)`       | 切换职位状态（如上线/下线）。                                      |

### 4.8 TalentSearchService (人才搜索服务)
处理企业用户搜索和筛选人才（简历）的业务逻辑。

| 函数名                      | 描述                                                                   |
| --------------------------- | ---------------------------------------------------------------------- |
| `getApplicantsByJobId(jobId)` | 获取投递了指定职位ID的申请者（简历）列表。                                       |
| `searchResumes(criteria)`   | (如果系统支持企业主动搜索简历库) 根据指定条件搜索简历。                                |

### 4.9 AdminService (管理员服务)
处理管理员在后台进行的各项管理功能的业务逻辑。

| 函数名                                      | 描述                                                               |
| ------------------------------------------- | ------------------------------------------------------------------ |
| `getUsers(filter)`                          | 根据筛选条件获取个人用户列表。                                               |
| `updateUserStatus(userId, status)`          | 更新指定个人用户ID的账户状态。                                             |
| `getEnterprises(filter)`                    | 根据筛选条件获取企业用户列表。                                               |
| `approveEnterprise(enterpriseId, opinion)`  | 批准指定企业ID的注册申请，可附带审核意见。                                     |
| `rejectEnterprise(enterpriseId, opinion)`   | 拒绝指定企业ID的注册申请，需附带审核意见。                                     |
| `getAllJobs(filter)`                        | 根据筛选条件获取系统内所有职位列表。                                           |
| `updateJobStatus(jobId, status)`            | 更新指定职位ID的状态（如审核通过、强制下线等）。                                   |

### 4.10 FeedbackService (反馈服务)
处理用户反馈的提交和管理的业务逻辑。

| 函数名                            | 描述                                                               |
| --------------------------------- | ------------------------------------------------------------------ |
| `submitFeedback(feedbackData)`    | 用户提交反馈信息。                                                       |
| `getFeedbacks(filter)`            | 根据筛选条件获取反馈列表（通常由管理员使用）。                                     |
| `processFeedback(feedbackId, reply)` | 管理员处理指定的反馈信息，如进行回复。                                         |

### 4.11 AnnouncementService (公告服务)
处理系统公告的创建、发布和管理的业务逻辑。

| 函数名                                    | 描述                               |
| ----------------------------------------- | ---------------------------------- |
| `createAnnouncement(announcementData)`    | 创建新的系统公告。                             |
| `getAnnouncements(filter)`                | 根据筛选条件获取公告列表。                         |
| `updateAnnouncement(announcementId, data)` | 更新指定公告ID的公告内容。                       |
| `deleteAnnouncement(announcementId)`      | 删除指定公告ID的公告。                         |

## 5. 数据访问层 (DAL - Data Access Layer)
数据访问层负责与数据库进行直接交互，执行数据的创建（Create）、读取（Read）、更新（Update）和删除（Delete）等操作。它将底层的SQL操作封装起来，为服务层提供简洁的数据操作接口。

### 5.1 DatabaseManager (数据库管理器)
中央数据库连接管理器，负责初始化数据库连接、提供连接实例以及管理事务。

| 函数名                        | 描述                                                               |
| ----------------------------- | ------------------------------------------------------------------ |
| `initializeDb()`              | 初始化数据库连接或连接池。                                                 |
| `getConnection()`             | 获取一个数据库连接实例。                                                 |
| `executeQuery(sql, params)`   | 执行给定的SQL查询语句（通常是SELECT语句）并返回结果。                               |
| `executeTransaction(queries)` | 执行一组SQL语句作为一个事务，确保原子性。                                       |

### 5.2 IndividualUserDAO (个人用户数据访问对象)
封装对个人用户表 (IndividualUsers) 的所有数据库操作。

| 函数名                        | 描述                                                         |
| ----------------------------- | ------------------------------------------------------------ |
| `findById(id)`                | 根据用户ID查询个人用户信息。                                         |
| `findByUsername(username)`    | 根据用户名查询个人用户信息。                                         |
| `findByEmail(email)`          | 根据邮箱查询个人用户信息。                                         |
| `create(userData)`            | 向数据库中插入一条新的个人用户记录。                                     |
| `update(id, userData)`        | 更新指定ID的个人用户信息。                                         |
| `updatePassword(id, passwordHash)` | 更新指定ID的个人用户的密码哈希。                                     |
| `updateStatus(id, status)`    | 更新指定ID的个人用户的账户状态。                                     |

### 5.3 ResumeDAO (简历数据访问对象)
封装对简历表 (Resumes) 的所有数据库操作。

| 函数名                   | 描述                                   |
| ------------------------ | -------------------------------------- |
| `findById(id)`           | 根据简历ID查询简历信息。                         |
| `findByUserId(userId)`   | 根据用户ID查询该用户的所有简历。                   |
| `create(resumeData)`     | 向数据库中插入一条新的简历记录。                     |
| `update(id, resumeData)` | 更新指定ID的简历信息。                         |
| `delete(id)`             | 删除指定ID的简历记录。                         |

### 5.4 EnterpriseUserDAO (企业用户数据访问对象)
封装对企业用户表 (EnterpriseUsers) 的所有数据库操作。

| 函数名                          | 描述                                                         |
| ------------------------------- | ------------------------------------------------------------ |
| `findById(id)`                  | 根据企业ID查询企业用户信息。                                         |
| `findByUsername(username)`      | 根据企业登录用户名查询企业用户信息。                                     |
| `findByCreditCode(creditCode)`  | 根据统一社会信用代码查询企业用户信息。                                   |
| `create(enterpriseData)`        | 向数据库中插入一条新的企业用户记录。                                     |
| `update(id, enterpriseData)`    | 更新指定ID的企业用户信息。                                         |
| `updatePassword(id, passwordHash)` | 更新指定ID的企业用户的密码哈希。                                     |
| `updateStatus(id, status)`      | 更新指定ID的企业用户的账户状态和审核意见。                                 |

### 5.5 JobPostingDAO (招聘岗位数据访问对象)
封装对招聘岗位表 (JobPostings) 的所有数据库操作。

| 函数名                         | 描述                                                               |
| ------------------------------ | ------------------------------------------------------------------ |
| `findById(id)`                 | 根据岗位ID查询招聘岗位信息。                                               |
| `findByEnterpriseId(enterpriseId)` | 根据企业ID查询该企业发布的所有招聘岗位。                                       |
| `findByCriteria(criteria)`     | 根据指定的查询条件（如关键词、地点、类别等）查询招聘岗位。                             |
| `create(jobData)`              | 向数据库中插入一条新的招聘岗位记录。                                         |
| `update(id, jobData)`          | 更新指定ID的招聘岗位信息。                                               |
| `delete(id)`                   | 删除指定ID的招聘岗位记录。                                               |
| `updateStatus(id, status)`     | 更新指定ID的招聘岗位的状态。                                             |

### 5.6 JobApplicationDAO (职位申请数据访问对象)
封装对职位申请记录表 (JobApplications) 的所有数据库操作。

| 函数名                               | 描述                                                               |
| ------------------------------------ | ------------------------------------------------------------------ |
| `findById(id)`                       | 根据申请ID查询职位申请记录。                                               |
| `findByUserIdAndJobId(userId, jobId)` | 根据用户ID和职位ID查询是否已存在申请记录。                                     |
| `findByUserId(userId)`               | 根据用户ID查询该用户的所有职位申请记录。                                       |
| `findByJobId(jobId)`                 | 根据职位ID查询该职位的所有申请记录。                                         |
| `create(applicationData)`            | 向数据库中插入一条新的职位申请记录。                                         |
| `updateStatus(id, status)`           | 更新指定ID的职位申请记录的状态。                                           |

### 5.7 AdminUserDAO (管理员用户数据访问对象)
封装对管理员用户表 (AdminUsers) 的所有数据库操作。

| 函数名                          | 描述                                                         |
| ------------------------------- | ------------------------------------------------------------ |
| `findById(id)`                  | 根据管理员ID查询管理员用户信息。                                       |
| `findByUsername(username)`      | 根据管理员用户名查询管理员用户信息。                                     |
| `update(id, adminData)`         | 更新指定ID的管理员用户信息。                                       |
| `updatePassword(id, passwordHash)` | 更新指定ID的管理员用户的密码哈希。                                   |

### 5.8 FeedbackDAO (反馈数据访问对象)
封装对用户反馈表 (Feedbacks) 的所有数据库操作。

| 函数名                     | 描述                                                               |
| -------------------------- | ------------------------------------------------------------------ |
| `findById(id)`             | 根据反馈ID查询反馈信息。                                                 |
| `findAll(filter)`          | 根据筛选条件查询反馈列表。                                               |
| `create(feedbackData)`     | 向数据库中插入一条新的反馈记录。                                           |
| `update(id, feedbackData)` | 更新指定ID的反馈信息（如处理状态、回复内容）。                                 |

### 5.9 AnnouncementDAO (公告数据访问对象)
封装对系统公告表 (Announcements) 的所有数据库操作。

| 函数名                         | 描述                                   |
| ------------------------------ | -------------------------------------- |
| `findById(id)`                 | 根据公告ID查询公告信息。                         |
| `findAll(filter)`              | 根据筛选条件查询公告列表。                       |
| `create(announcementData)`     | 向数据库中插入一条新的公告记录。                     |
| `update(id, announcementData)` | 更新指定ID的公告信息。                         |
| `delete(id)`                   | 删除指定ID的公告记录。                         |

## 6. 工具层 (Utility Layer)
工具层提供各种通用的、与具体业务无关的功能函数或类，供其他各层调用。

### 6.1 SecurityUtils (安全工具类)
提供安全相关的功能，如密码处理、JWT生成与验证。

| 函数名                      | 描述                                                                     |
| --------------------------- | ------------------------------------------------------------------------ |
| `hashPassword(password)`    | 将明文密码进行哈希加密处理（通常加盐）。                                           |
| `verifyPassword(password, hash)` | 验证明文密码是否与存储的哈希密码匹配。                                           |
| `generateJWT(payload)`      | 根据给定的载荷信息（如用户ID、角色、过期时间）生成JWT字符串。                               |
| `verifyJWT(token)`          | 验证传入的JWT字符串的有效性、签名和是否过期，并解析出载荷信息。                               |

### 6.2 ValidationUtils (验证工具类)
提供数据校验相关的功能，如邮箱格式验证、手机号格式验证等。

| 函数名                      | 描述                                                                     |
| --------------------------- | ------------------------------------------------------------------------ |
| `validateEmail(email)`      | 验证给定的字符串是否为合法的电子邮件格式。                                           |
| `validatePhone(phone)`      | 验证给定的字符串是否为合法的电话号码格式。                                           |
| `validateUsername(username)`| 验证用户名的格式是否符合规定（如长度、允许字符等）。                                     |
| `validateSchema(data, schema)` | 根据预定义的JSON Schema或其他模式来验证数据的结构和类型。                               |

### 6.3 Logger (日志工具类)
提供统一的日志记录接口，用于记录不同级别的日志信息（如信息、错误、调试、警告）。

| 函数名                 | 描述                                                               |
| ---------------------- | ------------------------------------------------------------------ |
| `info(message)`        | 记录普通信息级别的日志。                                                   |
| `error(message, error)` | 记录错误级别的日志，可附加错误对象或堆栈信息。                                     |
| `debug(message)`       | 记录调试级别的日志，通常用于开发阶段。                                           |
| `warn(message)`        | 记录警告级别的日志。                                                   |

### 6.4 ConfigManager (配置管理器类)
负责加载和读取应用程序的配置信息，如数据库连接参数、服务器端口、密钥等。

| 函数名                  | 描述                                                               |
| ----------------------- | ------------------------------------------------------------------ |
| `loadConfig(filepath)`  | 从指定的配置文件（如JSON, YAML, INI文件）加载配置信息到内存。                        |
| `getValue(key)`         | 根据键名获取对应的配置项的值。                                             |

## 4. 关键模块关系说明

### 4.1 控制流向
1. 外部HTTP请求首先到达Crow服务器
2. 请求经过中间件链（如身份验证、日志记录）
3. `ApiRouter`将请求路由到适当的控制器方法
4. 控制器调用相应的服务层方法处理业务逻辑
5. 服务层通过DAO与数据库交互
6. 结果沿原路返回到客户端

### 4.2 主要依赖关系
- 控制器依赖于服务层组件
- 服务层依赖于数据访问层组件
- 数据访问层依赖于`DatabaseManager`
- 各层可能使用工具层的组件（如验证、日志记录）

### 4.3 核心模块功能详解

#### 认证与授权流程
1. `AuthController` 接收登录/注册请求
2. 调用 `AuthService` 验证凭据/创建账户
3. `AuthService` 使用 `SecurityUtils` 处理密码哈希和JWT
4. 成功认证后返回JWT给前端
5. 后续请求通过 `AuthMiddleware` 验证JWT

#### 职位申请流程
1. `JobController.applyForJob` 接收申请请求
2. 调用 `ApplicationService.applyForJob` 处理业务逻辑
3. `ApplicationService` 通过 `JobApplicationDAO` 持久化申请记录
4. 关联个人用户、简历和企业职位

#### 企业审核流程
1. `AdminController.approveEnterprise` 接收审核请求
2. 调用 `AdminService.approveEnterprise` 处理业务逻辑
3. `AdminService` 通过 `EnterpriseUserDAO` 更新企业状态

## 5. 技术实现考虑
- 使用C++17(或更高)和Crow微框架实现
- SQLite作为持久化存储
- 所有数据访问通过DAL层封装，避免SQL注入
- JWT用于无状态身份验证
- 密码存储使用安全哈希算法（如Argon2、bcrypt）

这种架构设计使系统具有良好的模块化和可维护性，同时为未来可能的扩展预留了空间。模块间的职责明确，依赖关系清晰，便于团队协作开发和测试。